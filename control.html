<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoreboard Control</title>
<style>
body {
  background-color: #111;
  color: #fff;
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 10px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Gear button centered */
.settings-btn {
  font-size: 28px;
  background: none;
  border: none;
  color: #fff;
  margin: 10px 0;
  cursor: pointer;
}

/* Modal overlay */
.modal-overlay {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 100;
}

/* Modal content */
.modal {
  background: #222;
  padding: 20px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.modal h3 {
  text-align: center;
  margin: 0 0 10px 0;
}

.modal .team-select {
  display: flex;
  justify-content: space-between;
  gap: 10px;
}

.modal .team-select div {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.modal select, .modal input {
  padding: 8px;
  border-radius: 6px;
  border: none;
  font-size: 16px;
}

.modal button {
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
}

.modal .update-btn {
  background-color: #28a745;
  color: white;
}

.modal .cancel-btn {
  background-color: #dc3545;
  color: white;
}
</style>
</head>
<body>

<button class="settings-btn" onclick="openSettings()">⚙️</button>

<!-- Scoreboard controls -->
<div class="scoreboard">
  <div class="team-row">
    <span id="teamANameDisplay">SPKAC Leafs</span>
    <span id="teamBNameDisplay">CAC Imperial</span>
  </div>
  <div class="score-row">
    <span id="teamAScore">0</span>
    <span style="opacity:0.8;">-</span>
    <span id="teamBScore">0</span>
  </div>
  <div class="shots-row">
    <span id="teamAShots">Shots: 0</span>
    <span id="teamBShots">Shots: 0</span>
  </div>
</div>

<div class="clock-section">
  <button onclick="setPeriod()">Period</button>
  <div style="flex:2; text-align:center;">
    <div id="timer">20:00</div>
    <div id="periodDisplay">Period 1</div>
  </div>
  <button onclick="setClock()">Clock</button>
</div>

<button id="startStopBtn" onclick="toggleClock()">Start</button>

<div class="team-controls">
  <!-- Team A -->
  <div class="team-column">
    <button class="plus" onclick="updateShots('A',1)">+1 Shot</button>
    <button class="minus" onclick="updateShots('A',-1)">-1 Shot</button>
    <button class="plus" onclick="updateScore('A',1)">+1 Goal</button>
    <button class="minus" onclick="updateScore('A',-1)">-1 Goal</button>
  </div>
  <!-- Team B -->
  <div class="team-column">
    <button class="plus" onclick="updateShots('B',1)">+1 Shot</button>
    <button class="minus" onclick="updateShots('B',-1)">-1 Shot</button>
    <button class="plus" onclick="updateScore('B',1)">+1 Goal</button>
    <button class="minus" onclick="updateScore('B',-1)">-1 Goal</button>
  </div>
</div>

<!-- Modal for team selection -->
<div class="modal-overlay" id="teamModal">
  <div class="modal">
    <h3>Select Teams</h3>
    <div class="team-select">
      <div>
        <label>Team A</label>
        <select id="teamASelect" onchange="checkCustom('A')"></select>
        <input type="text" id="teamACustom" placeholder="Custom Team A" style="display:none;">
      </div>
      <div>
        <label>Team B</label>
        <select id="teamBSelect" onchange="checkCustom('B')"></select>
        <input type="text" id="teamBCustom" placeholder="Custom Team B" style="display:none;">
      </div>
    </div>
    <button class="update-btn" onclick="updateTeams()">Update</button>
    <button class="cancel-btn" onclick="closeModal()">Cancel</button>
  </div>
</div>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycbytIuXy17Y27QTgQdXsFVUeAKKGQJr8q588j3cVWU5qPZ6RzrobufWA-LZx2gJgzz--/exec";

let timerInterval;
let isRunning = false;
let timeRemaining = 20*60;
let period = 1;

// Example: populate team list dynamically
const teamList = ["-- Custom --", "SPKAC Leafs","CAC Imperial Equities","Team X","Team Y"]; // Replace with actual sheet teamlist fetch if needed

function populateTeamDropdowns(){
  const selectA = document.getElementById("teamASelect");
  const selectB = document.getElementById("teamBSelect");
  teamList.forEach(team => {
    selectA.add(new Option(team, team));
    selectB.add(new Option(team, team));
  });
}

// Show custom input field if '-- Custom --' selected
function checkCustom(team){
  const select = document.getElementById(`team${team}Select`);
  const input = document.getElementById(`team${team}Custom`);
  input.style.display = (select.value === "-- Custom --") ? "block" : "none";
}

// Open modal
function openSettings(){
  populateTeamDropdowns();
  document.getElementById("teamModal").style.display = "flex";
}

// Close modal
function closeModal(){
  document.getElementById("teamModal").style.display = "none";
}

// Push team updates
async function updateTeams(){
  const teamASelect = document.getElementById("teamASelect").value;
  const teamBSelect = document.getElementById("teamBSelect").value;
  const teamAName = (teamASelect==="-- Custom --") ? document.getElementById("teamACustom").value : teamASelect;
  const teamBName = (teamBSelect==="-- Custom --") ? document.getElementById("teamBCustom").value : teamBSelect;

  if(teamAName.trim() || teamBName.trim()){
    const payload = {};
    if(teamAName.trim()) payload.teamAName = teamAName.trim();
    if(teamBName.trim()) payload.teamBName = teamBName.trim();

    try{
      await fetch(DATA_URL, {
        method:'POST',
        body: JSON.stringify(payload),
        headers: {'Content-Type':'application/json'}
      });
    }catch(err){ console.error(err); }
  }
  closeModal();
}

// Timer tick
function tick(){
  if(isRunning && timeRemaining>0){
    timeRemaining--;
    updateTimerDisplay();
    pushUpdate({TimerSeconds: timeRemaining});
  }
}

// Format timer
function formatTime(sec){
  const m=Math.floor(sec/60);
  const s=sec%60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateTimerDisplay(){
  document.getElementById('timer').textContent = formatTime(timeRemaining);
  document.getElementById('periodDisplay').textContent = `Period ${period}`;
}

// Start/Stop
function toggleClock(){
  isRunning = !isRunning;
  updateStartStopBtn();
  pushUpdate({Running:isRunning});
}

function updateStartStopBtn(){
  const btn = document.getElementById('startStopBtn');
  if(isRunning){ btn.textContent='Stop'; btn.style.backgroundColor='#dc3545'; }
  else{ btn.textContent='Start'; btn.style.backgroundColor='#28a745'; }
}

// Period / Clock manual
function setPeriod(){
  const val=parseInt(prompt("Enter Period number:"));
  if(!isNaN(val) && val>0){
    period=val;
    updateTimerDisplay();
    pushUpdate({Period: period});
  }
}
function setClock(){
  const input=prompt("Enter time (MM:SS):");
  if(input && /^\d{1,2}:\d{2}$/.test(input)){
    const [m,s] = input.split(':').map(Number);
    timeRemaining = m*60 + s;
    updateTimerDisplay();
    pushUpdate({TimerSeconds: timeRemaining});
  }
}

// Score/Shot updates
function updateScore(team, change){
  const el=document.getElementById(`team${team}Score`);
  const newVal=Math.max(0,parseInt(el.textContent)+change);
  el.textContent=newVal;
  pushUpdate({[`team${team}Score`]: newVal});
}
function updateShots(team, change){
  const el=document.getElementById(`team${team}Shots`);
  const current=parseInt(el.textContent.replace('Shots: ','')||0);
  const newVal=Math.max(0,current+change);
  el.textContent=`Shots: ${newVal}`;
  pushUpdate({[`team${team}Shots`]: newVal});
}

// Push updates to sheet
async function pushUpdate(payload){
  try{
    await fetch(DATA_URL,{
      method:'POST',
      body: JSON.stringify(payload),
      headers: {'Content-Type':'application/json'}
    });
    await fetchData();
  }catch(err){ console.error(err); }
}

// Fetch sheet data
async function fetchData(){
  try{
    const res = await fetch(DATA_URL);
    const data = await res.json();
    document.getElementById('teamANameDisplay').textContent = data.teamAName;
    document.getElementById('teamBNameDisplay').textContent = data.teamBName;
    document.getElementById('teamAScore').textContent = data.teamAScore;
    document.getElementById('teamBScore').textContent = data.teamBScore;
    document.getElementById('teamAShots').textContent = `Shots: ${data.teamAShots}`;
    document.getElementById('teamBShots').textContent = `Shots: ${data.teamBShots}`;
    period = data.Period;
    timeRemaining = data.TimerSeconds;
    isRunning = data.Running;
    updateTimerDisplay();
    updateStartStopBtn();
  }catch(err){ console.error(err); }
}

// Initialize
fetchData();
timerInterval = setInterval(tick,1000);

</script>
</body>
</html>
