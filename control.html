<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoreboard Control</title>
<style>
  body {
    background-color: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Centered gear button */
  .settings-btn {
    font-size: 28px;
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    margin-bottom: 12px;
  }

  /* Top scoreboard */
  .scoreboard {
    width: 95%;
    background: #1e1e1e;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 12px;
    text-align: center;
  }
  .team-row {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 18px;
  }
  .score-row {
    display: flex;
    justify-content: space-between;
    font-size: 36px;
    margin-top: 6px;
  }
  .shots-row {
    display: flex;
    justify-content: space-between;
    font-size: 16px;
    margin-top: 4px;
    opacity: 0.85;
  }

  /* Clock + Period */
  .clock-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 95%;
    background: #1d1d1d;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 12px;
  }
  .clock-section button {
    flex: 1;
    font-size: 18px;
    padding: 14px 0;
    margin: 0 4px;
    border-radius: 8px;
    border: none;
    background-color: #333;
    color: #fff;
    cursor: pointer;
  }
  #timer {
    font-size: 28px;
    font-weight: bold;
    text-align: center;
  }
  #period {
    font-size: 18px;
    text-align: center;
    margin-top: 2px;
  }

  /* Start/Stop */
  #startStopBtn {
    width: 95%;
    font-size: 28px;
    padding: 40px 0;
    border-radius: 12px;
    border: none;
    color: white;
    background-color: #28a745;
    margin-bottom: 16px;
  }

  /* Team controls */
  .team-controls {
    display: flex;
    justify-content: space-between;
    width: 95%;
    gap: 10px;
  }
  .team-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .team-column button.plus {
    width: 100%;
    font-size: 24px;
    padding: 40px 0;
    border-radius: 10px;
    border: none;
    background-color: #555;
    color: #fff;
  }
  .team-column button.minus {
    width: 100%;
    font-size: 24px;
    padding: 12px 0;
    border-radius: 10px;
    border: none;
    background-color: #777;
    color: #fff;
  }

  /* Modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 10;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background-color: #222;
    padding: 20px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    color: #fff;
  }
  .modal-content label {
    font-size: 16px;
    margin-bottom: 4px;
  }
  .modal-content select, .modal-content input {
    font-size: 16px;
    padding: 8px;
    border-radius: 8px;
    border: none;
    width: 100%;
  }
  .modal-content button {
    font-size: 18px;
    padding: 10px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
  }
  .modal-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }
  .modal-buttons button.cancel {
    background-color: #555;
    color: #fff;
    flex: 1;
    margin-right: 6px;
  }
  .modal-buttons button.update {
    background-color: #28a745;
    color: #fff;
    flex: 1;
  }
</style>
</head>
<body>

<!-- Centered Gear Button -->
<button class="settings-btn" onclick="openSettings()">⚙️</button>

<!-- Top scoreboard -->
<div class="scoreboard">
  <div class="team-row">
    <span id="teamAName">SPKAC Leafs</span>
    <span id="teamBName">CAC Imperial</span>
  </div>
  <div class="score-row">
    <span id="teamAScore">0</span>
    <span style="opacity:0.8;">-</span>
    <span id="teamBScore">0</span>
  </div>
  <div class="shots-row">
    <span id="teamAShots">Shots: 0</span>
    <span id="teamBShots">Shots: 0</span>
  </div>
</div>

<!-- Clock + Period -->
<div class="clock-section">
  <button onclick="setPeriod()">Period</button>
  <div style="flex:2;">
    <div id="timer">20:00</div>
    <div id="period">Period 1</div>
  </div>
  <button onclick="setClock()">Clock</button>
</div>

<!-- Start/Stop -->
<button id="startStopBtn" onclick="toggleClock()">Start</button>

<!-- Team Controls -->
<div class="team-controls">
  <!-- Team A -->
  <div class="team-column">
    <button class="plus" onclick="updateShots('A',1)">+1 Shot</button>
    <button class="minus" onclick="updateShots('A',-1)">-1 Shot</button>
    <button class="plus" onclick="updateScore('A',1)">+1 Goal</button>
    <button class="minus" onclick="updateScore('A',-1)">-1 Goal</button>
  </div>
  <!-- Team B -->
  <div class="team-column">
    <button class="plus" onclick="updateShots('B',1)">+1 Shot</button>
    <button class="minus" onclick="updateShots('B',-1)">-1 Shot</button>
    <button class="plus" onclick="updateScore('B',1)">+1 Goal</button>
    <button class="minus" onclick="updateScore('B',-1)">-1 Goal</button>
  </div>
</div>

<!-- Team Selection Modal -->
<div id="teamModal" class="modal">
  <div class="modal-content">
    <label for="teamSelect">Select Team:</label>
    <select id="teamSelect"></select>
    <input type="text" id="customTeam" placeholder="-- Custom --" style="display:none;">
    <div class="modal-buttons">
      <button class="cancel" onclick="closeModal()">Cancel</button>
      <button class="update" onclick="updateTeam()">Update</button>
    </div>
  </div>
</div>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycbytIuXy17Y27QTgQdXsFVUeAKKGQJr8q588j3cVWU5qPZ6RzrobufWA-LZx2gJgzz--/exec"; // replace with your /exec URL

let timerInterval;
let isRunning = false;
let timeRemaining = 20*60;
let period = 1;
let currentTeamSide = null; // "A" or "B"

// Timer functions
function formatTime(sec){
  const m = Math.floor(sec/60);
  const s = sec % 60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateTimerDisplay(){
  document.getElementById('timer').textContent = formatTime(timeRemaining);
  document.getElementById('period').textContent = `Period ${period}`;
}

function toggleClock(){
  const btn = document.getElementById('startStopBtn');
  if(isRunning){
    clearInterval(timerInterval);
    isRunning=false;
    btn.textContent='Start';
    btn.style.backgroundColor='#28a745';
  } else {
    isRunning=true;
    btn.textContent='Stop';
    btn.style.backgroundColor='#dc3545';
    timerInterval = setInterval(()=>{
      if(timeRemaining>0){
        timeRemaining--;
        updateTimerDisplay();
      } else {
        clearInterval(timerInterval);
        isRunning=false;
        btn.textContent='Start';
        btn.style.backgroundColor='#28a745';
      }
    },1000);
  }
}

function setPeriod(){
  const input=prompt("Enter Period number:");
  const val=parseInt(input);
  if(!isNaN(val) && val>0){
    period=val;
    updateTimerDisplay();
  }
}

function setClock(){
  const input=prompt("Enter time (MM:SS):");
  if(input && /^\d{1,2}:\d{2}$/.test(input)){
    const [m,s] = input.split(':').map(Number);
    timeRemaining = m*60 + s;
    updateTimerDisplay();
  }
}

function updateScore(team, change){
  const el=document.getElementById(`team${team}Score`);
  el.textContent = Math.max(0,parseInt(el.textContent)+change);
}

function updateShots(team, change){
  const el=document.getElementById(`team${team}Shots`);
  const current = parseInt(el.textContent.replace('Shots: ','')||0);
  el.textContent = `Shots: ${Math.max(0,current+change)}`;
}

// Modal functions
async function openSettings(){
  currentTeamSide = prompt("Which team to change? (A/B)");
  if(currentTeamSide !== "A" && currentTeamSide !== "B") return;

  // Fetch team list from Google Sheet
  try{
    const res = await fetch(DATA_URL);
    const data = await res.json();
    const teamlist = data.teamlist || [];
    const select = document.getElementById('teamSelect');
    select.innerHTML = '';
    teamlist.forEach(team=>{
      const opt = document.createElement('option');
      opt.value = team;
      opt.textContent = team;
      select.appendChild(opt);
    });
    select.innerHTML += `<option value="--Custom--">-- Custom --</option>`;
    document.getElementById('customTeam').style.display='none';
    select.onchange = ()=>{
      if(select.value === "--Custom--") document.getElementById('customTeam').style.display='block';
      else document.getElementById('customTeam').style.display='none';
    }
    document.getElementById('teamModal').style.display='flex';
  }catch(err){ console.error(err); }
}

function closeModal(){
  document.getElementById('teamModal').style.display='none';
}

async function updateTeam(){
  const select = document.getElementById('teamSelect');
  let value = select.value;
  if(value === "--Custom--"){
    value = document.getElementById('customTeam').value.trim();
    if(!value) return alert("Please enter a custom team name.");
  }
  // Push to Google Sheet
  try{
    const payload = {};
    payload[`team${currentTeamSide}Name`] = value;
    await fetch(DATA_URL,{
      method:'POST',
      body: JSON.stringify(payload),
      headers: {'Content-Type':'application/json'}
    });
    closeModal();
  }catch(err){ console.error(err); }
}

// Initialize timer display
updateTimerDisplay();
</script>
</body>
</html>
