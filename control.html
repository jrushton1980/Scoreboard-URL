<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Scoreboard Control</title>

<style>
  :root {
    --font-family: Arial, sans-serif;
    --bg-color: #111;
    --text-color: #fff;
    --btn-bg: #222;
    --btn-hover: #333;
    --accent: #0d6efd;
  }

  body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: var(--font-family);
    margin: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    font-size: 24px;
    margin-bottom: 10px;
  }

  .team {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 95%;
    max-width: 400px;
    margin: 5px 0;
    padding: 10px;
    border: 1px solid #333;
    border-radius: 8px;
    background: #1a1a1a;
  }

  .team-name {
    font-size: 20px;
    font-weight: bold;
  }

  .score, .shots {
    font-size: 18px;
  }

  button {
    background: var(--btn-bg);
    color: white;
    border: none;
    padding: 10px 15px;
    margin: 5px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.2s;
  }

  button:hover {
    background: var(--btn-hover);
  }

  .period, .timer {
    font-size: 20px;
    margin: 10px 0;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 400px;
  }

  .timer-controls {
    margin-top: 10px;
  }

  @media (max-width: 600px) {
    h1 { font-size: 20px; }
    button { font-size: 14px; padding: 8px 12px; }
    .team-name { font-size: 18px; }
  }
</style>
</head>

<body>
  <h1>Scoreboard Control</h1>

  <div class="team" id="teamA">
    <span class="team-name" id="teamAName">Team A</span>
    <span class="score" id="teamAScore">Score: 0</span>
    <span class="shots" id="teamAShots">Shots: 0</span>
  </div>
  <div class="controls">
    <button onclick="changeValue('teamAScore', 1)">+1 Goal A</button>
    <button onclick="changeValue('teamAScore', -1)">-1 Goal A</button>
    <button onclick="changeValue('teamAShots', 1)">+1 Shot A</button>
    <button onclick="changeValue('teamAShots', -1)">-1 Shot A</button>
  </div>

  <div class="team" id="teamB">
    <span class="team-name" id="teamBName">Team B</span>
    <span class="score" id="teamBScore">Score: 0</span>
    <span class="shots" id="teamBShots">Shots: 0</span>
  </div>
  <div class="controls">
    <button onclick="changeValue('teamBScore', 1)">+1 Goal B</button>
    <button onclick="changeValue('teamBScore', -1)">-1 Goal B</button>
    <button onclick="changeValue('teamBShots', 1)">+1 Shot B</button>
    <button onclick="changeValue('teamBShots', -1)">-1 Shot B</button>
  </div>

  <div class="period">
    <strong>Period:</strong> <span id="Period">1</span><br>
    <button onclick="changeValue('Period', 1)">Next Period</button>
    <button onclick="changeValue('Period', -1)">Prev Period</button>
  </div>

  <div class="timer">
    <strong>Timer:</strong> <span id="TimerDisplay">20:00</span>
    <div class="timer-controls">
      <button onclick="toggleTimer()">Start/Stop</button>
      <button onclick="resetTimer()">Reset</button>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwShiLdOPkMPI6BR6-NLXlyjb4y8KcKNdcokuFa8iC7EZ1vdMiyl3PzqZrVApmKgDDq/exec";
let state = {
  teamAName: "",
  teamBName: "",
  teamAScore: 0,
  teamBScore: 0,
  teamAShots: 0,
  teamBShots: 0,
  Period: 1,
  TimerSeconds: 1200,
  Running: false,
};
let timerInterval = null;

// ----------------- INITIALIZATION -----------------
async function init() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    state = { ...state, ...data };
    updateUI();
  } catch (err) {
    console.error("Initialization error:", err);
  }
}

// ----------------- UI UPDATE -----------------
function updateUI() {
  document.getElementById("teamAName").textContent = state.teamAName || "Team A";
  document.getElementById("teamBName").textContent = state.teamBName || "Team B";
  document.getElementById("teamAScore").textContent = `Score: ${state.teamAScore}`;
  document.getElementById("teamBScore").textContent = `Score: ${state.teamBScore}`;
  document.getElementById("teamAShots").textContent = `Shots: ${state.teamAShots}`;
  document.getElementById("teamBShots").textContent = `Shots: ${state.teamBShots}`;
  document.getElementById("Period").textContent = state.Period;
  updateTimerDisplay();
}

// ----------------- TIMER FUNCTIONS -----------------
function toggleTimer() {
  state.Running = !state.Running;
  if (state.Running) {
    startLocalTimer();
  } else {
    stopLocalTimer();
  }
  pushUpdate("Running", state.Running);
}

function startLocalTimer() {
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if (state.TimerSeconds > 0) {
      state.TimerSeconds--;
      updateTimerDisplay();
    } else {
      stopLocalTimer();
    }
  }, 1000);

  // Sync every 5s
  setInterval(() => pushUpdate("TimerSeconds", state.TimerSeconds), 5000);
}

function stopLocalTimer() {
  if (timerInterval) clearInterval(timerInterval);
  timerInterval = null;
}

function resetTimer() {
  state.TimerSeconds = 1200;
  updateTimerDisplay();
  pushUpdate("TimerSeconds", state.TimerSeconds);
}

function updateTimerDisplay() {
  const mins = Math.floor(state.TimerSeconds / 60);
  const secs = state.TimerSeconds % 60;
  document.getElementById("TimerDisplay").textContent =
    `${mins}:${secs.toString().padStart(2, "0")}`;
}

// ----------------- SCORE & SHOT UPDATES -----------------
function changeValue(field, delta) {
  state[field] = Math.max(0, (state[field] || 0) + delta);
  updateUI();
  pushUpdate(field, state[field]);
}

// ----------------- PUSH TO GOOGLE SHEETS -----------------
async function pushUpdate(field, value) {
  try {
    const url = `${API_URL}?update=true&field=${field}&value=${encodeURIComponent(value)}`;
    const res = await fetch(url);
    const result = await res.json();
    if (!result.success) console.error("Failed to update:", field);
  } catch (err) {
    console.error("Push update error:", err);
  }
}

// ----------------- START -----------------
init();
</script>
</body>
</html>
