<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoreboard Control</title>
<style>
  body {
    background-color: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* Top scoreboard */
  .scoreboard {
    width: 95%;
    background: #1e1e1e;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 12px;
    text-align: center;
  }
  .team-row {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 18px;
  }
  .score-row {
    display: flex;
    justify-content: space-between;
    font-size: 36px;
    margin-top: 6px;
  }
  .shots-row {
    display: flex;
    justify-content: space-between;
    font-size: 16px;
    margin-top: 4px;
    opacity: 0.85;
  }

  /* Clock + Period */
  .clock-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 95%;
    background: #1d1d1d;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 12px;
  }
  .clock-section button {
    flex: 1;
    font-size: 18px;
    padding: 14px 0;
    margin: 0 4px;
    border-radius: 8px;
    border: none;
    background-color: #333;
    color: #fff;
    cursor: pointer;
  }
  #timer {
    font-size: 28px;
    font-weight: bold;
    text-align: center;
  }
  #period {
    font-size: 18px;
    text-align: center;
    margin-top: 2px;
  }

  /* Start/Stop */
  #startStopBtn {
    width: 95%;
    font-size: 28px;
    padding: 40px 0;
    border-radius: 12px;
    border: none;
    color: white;
    background-color: #28a745;
    margin-bottom: 16px;
  }

  /* Team controls */
  .team-controls {
    display: flex;
    justify-content: space-between;
    width: 95%;
    gap: 10px;
  }
  .team-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .team-column button.plus {
    width: 100%;
    font-size: 24px;
    padding: 40px 0;
    border-radius: 10px;
    border: none;
    background-color: #555;
    color: #fff;
  }
  .team-column button.minus {
    width: 100%;
    font-size: 24px;
    padding: 12px 0;
    border-radius: 10px;
    border: none;
    background-color: #777;
    color: #fff;
  }

  /* Settings icon */
  .settings-btn {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: none;
    border: none;
    color: #fff;
    font-size: 28px;
    cursor: pointer;
  }
</style>
</head>
<body>
<button class="settings-btn" onclick="openSettings()">⚙️</button>

<!-- Top scoreboard -->
<div class="scoreboard">
  <div class="team-row">
    <span id="teamAName">Team A</span>
    <span id="teamBName">Team B</span>
  </div>
  <div class="score-row">
    <span id="teamAScore">0</span>
    <span style="opacity:0.8;">-</span>
    <span id="teamBScore">0</span>
  </div>
  <div class="shots-row">
    <span id="teamAShots">Shots: 0</span>
    <span id="teamBShots">Shots: 0</span>
  </div>
</div>

<!-- Clock + Period -->
<div class="clock-section">
  <button onclick="setPeriod()">Period</button>
  <div style="flex:2;">
    <div id="timer">20:00</div>
    <div id="period">Period 1</div>
  </div>
  <button onclick="setClock()">Clock</button>
</div>

<!-- Start/Stop -->
<button id="startStopBtn" onclick="toggleClock()">Start</button>

<!-- Team Controls -->
<div class="team-controls">
  <!-- Team A -->
  <div class="team-column">
    <button class="plus" onclick="updateShots('A',1)">+1 Shot</button>
    <button class="minus" onclick="updateShots('A',-1)">-1 Shot</button>
    <button class="plus" onclick="updateScore('A',1)">+1 Goal</button>
    <button class="minus" onclick="updateScore('A',-1)">-1 Goal</button>
  </div>

  <!-- Team B -->
  <div class="team-column">
    <button class="plus" onclick="updateShots('B',1)">+1 Shot</button>
    <button class="minus" onclick="updateShots('B',-1)">-1 Shot</button>
    <button class="plus" onclick="updateScore('B',1)">+1 Goal</button>
    <button class="minus" onclick="updateScore('B',-1)">-1 Goal</button>
  </div>
</div>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycbztgl-q8BQ7XVmR664a0gvwhMr2hrnuAqbSPBvj_WHKDFA-jMyJ17qPa-B_PbeVtC3e/exec";

let timerInterval;
let isRunning = false;
let timeRemaining = 20 * 60;
let period = 1;

function formatTime(sec){
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateTimerDisplay(){
  document.getElementById('timer').textContent = formatTime(timeRemaining);
  document.getElementById('period').textContent = `Period ${period}`;
}

function toggleClock(){
  const btn = document.getElementById('startStopBtn');
  if(isRunning){
    clearInterval(timerInterval);
    isRunning = false;
    btn.textContent = 'Start';
    btn.style.backgroundColor = '#28a745';
    pushUpdate({ Running: false, TimerSeconds: timeRemaining });
  } else {
    isRunning = true;
    btn.textContent = 'Stop';
    btn.style.backgroundColor = '#dc3545';
    pushUpdate({ Running: true, TimerSeconds: timeRemaining });
    timerInterval = setInterval(() => {
      if(timeRemaining > 0){
        timeRemaining--;
        updateTimerDisplay();
      } else {
        clearInterval(timerInterval);
        isRunning = false;
        btn.textContent = 'Start';
        btn.style.backgroundColor = '#28a745';
        pushUpdate({ Running: false, TimerSeconds: 0 });
      }
    }, 1000);
  }
}

function setPeriod(){
  const input = prompt("Enter Period number:");
  const val = parseInt(input);
  if(!isNaN(val) && val > 0){
    period = val;
    updateTimerDisplay();
    pushUpdate({ Period: period });
  }
}

function setClock(){
  const input = prompt("Enter time (MM:SS):");
  if(input && /^\d{1,2}:\d{2}$/.test(input)){
    const [m,s] = input.split(':').map(Number);
    timeRemaining = m*60 + s;
    updateTimerDisplay();
    pushUpdate({ TimerSeconds: timeRemaining });
  }
}

function updateScore(team, change){
  const el = document.getElementById(`team${team}Score`);
  const newVal = Math.max(0, parseInt(el.textContent) + change);
  el.textContent = newVal;
  pushUpdate({ [`team${team}Score`]: newVal });
}

function updateShots(team, change){
  const el = document.getElementById(`team${team}Shots`);
  const current = parseInt(el.textContent.replace('Shots: ', '')) || 0;
  const newVal = Math.max(0, current + change);
  el.textContent = `Shots: ${newVal}`;
  pushUpdate({ [`team${team}Shots`]: newVal });
}

async function fetchData(){
  try {
    const res = await fetch(DATA_URL);
    const data = await res.json();
    console.log("Loaded data:", data);

    if(data.teamAName) document.getElementById('teamAName').textContent = data.teamAName;
    if(data.teamBName) document.getElementById('teamBName').textContent = data.teamBName;
    if(data.teamAScore) document.getElementById('teamAScore').textContent = data.teamAScore;
    if(data.teamBScore) document.getElementById('teamBScore').textContent = data.teamBScore;
    if(data.teamAShots) document.getElementById('teamAShots').textContent = `Shots: ${data.teamAShots}`;
    if(data.teamBShots) document.getElementById('teamBShots').textContent = `Shots: ${data.teamBShots}`;
    if(data.Period) period = parseInt(data.Period);
    if(data.TimerSeconds) timeRemaining = parseInt(data.TimerSeconds);
    updateTimerDisplay();
  } catch (err) {
    console.error("Error fetching data:", err);
  }
}

async function pushUpdate(payload){
  console.log("Posting to Google Apps Script:", payload);
  try {
    const res = await fetch(DATA_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const text = await res.text();
    console.log("Response:", text);
  } catch (err) {
    console.error("Error posting:", err);
    alert("⚠️ Failed to post update — check console");
  }
}

function openSettings(){
  alert("Team selection screen coming soon!");
}

fetchData();
updateTimerDisplay();
</script>
</body>
</html>
