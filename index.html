<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scoreboard Overlay</title>
<style>
body { background: transparent; color: white; font-family: Arial, sans-serif; }
.row { display:flex; justify-content:space-between; width:100%; max-width:900px; margin:10px auto; }
.team { font-size:28px; font-weight:bold; }
.score { font-size:48px; }
#clock { font-size:36px; }
</style>
</head>
<body>

<div class="row">
  <div class="team" id="tA">Team A</div>
  <div class="score" id="sA">0</div>
  <div id="clock">20:00</div>
  <div class="score" id="sB">0</div>
  <div class="team" id="tB">Team B</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzch9SYxZbzoGwZm3rlgzDPmZes1mjFD0GWJrzTzuF-ndvH51lLW7HGTOZXfh0NdY_K/exec"; // replace with your web app URL

let overlayState = {
  teamAName: '', teamBName: '', teamAScore: 0, teamBScore: 0,
  teamAShots: 0, teamBShots: 0, Period: 1, TimerSeconds: 1200, Running: false
};

let overlayTimerInterval = null;
let lastRunning = null;

function formatTime(sec){
  const m = Math.floor(sec/60), s = sec%60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function applyState(data){
  // Update team names, scores, shots
  document.getElementById('tA').textContent = data.teamAName;
  document.getElementById('tB').textContent = data.teamBName;
  document.getElementById('sA').textContent = data.teamAScore;
  document.getElementById('sB').textContent = data.teamBScore;

  // Only update timer if Running changes
  if(lastRunning === null || lastRunning !== data.Running){
    overlayState.TimerSeconds = Number(data.TimerSeconds) || 0;
    document.getElementById('clock').textContent = formatTime(overlayState.TimerSeconds);
    lastRunning = data.Running;
  }

  // Start/stop clock locally
  if(data.Running && overlayTimerInterval === null){
    overlayTimerInterval = setInterval(()=>{
      if(overlayState.TimerSeconds>0){
        overlayState.TimerSeconds--;
        document.getElementById('clock').textContent = formatTime(overlayState.TimerSeconds);
      }
    },1000);
  } else if(!data.Running && overlayTimerInterval !== null){
    clearInterval(overlayTimerInterval);
    overlayTimerInterval = null;
  }
}

async function fetchState(){
  try{
    const res = await fetch(SCRIPT_URL);
    const data = await res.json();

    overlayState.teamAName = data.teamAName;
    overlayState.teamBName = data.teamBName;
    overlayState.teamAScore = Number(data.teamAScore)||0;
    overlayState.teamBScore = Number(data.teamBScore)||0;
    overlayState.teamAShots = Number(data.teamAShots)||0;
    overlayState.teamBShots = Number(data.teamBShots)||0;
    overlayState.Period = data.Period;
    overlayState.Running = !!data.Running;
    overlayState.TimerSeconds = Number(data.TimerSeconds) || 0;

    applyState(data);
  } catch(e){
    console.error('fetchState error:', e);
  }
}

// Poll every 0.5s
setInterval(fetchState, 500);
fetchState();

</script>
</body>
</html>
