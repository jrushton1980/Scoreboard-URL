<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoreboard Display</title>
<style>
  body {
    background-color: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .scoreboard {
    width: 95%;
    background: #1e1e1e;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 12px;
    text-align: center;
  }

  .team-row {
    display: flex;
    justify-content: space-between;
    font-weight: bold;
    font-size: 18px;
  }

  .score-row {
    display: flex;
    justify-content: space-between;
    font-size: 36px;
    margin-top: 6px;
  }

  .shots-row {
    display: flex;
    justify-content: space-between;
    font-size: 16px;
    margin-top: 4px;
    opacity: 0.85;
  }

  .clock-section {
    width: 95%;
    background: #1d1d1d;
    border-radius: 12px;
    padding: 10px;
    text-align: center;
    margin-bottom: 12px;
  }

  #timer {
    font-size: 48px;
    font-weight: bold;
    margin-bottom: 4px;
  }
  #period {
    font-size: 24px;
  }
</style>
</head>
<body>
<div class="scoreboard">
  <div class="team-row">
    <span id="teamAName">Team A</span>
    <span id="teamBName">Team B</span>
  </div>
  <div class="score-row">
    <span id="teamAScore">0</span>
    <span style="opacity:0.8;">-</span>
    <span id="teamBScore">0</span>
  </div>
  <div class="shots-row">
    <span id="teamAShots">Shots: 0</span>
    <span id="teamBShots">Shots: 0</span>
  </div>
</div>

<div class="clock-section">
  <div id="timer">20:00</div>
  <div id="period">Period 1</div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyD8EO--akOZZZNKGOEHk4mpc4Gk-1WXbiHyvVIOaSmxI5f20Wiwwh7XIyEc4TaOlxD/exec";

let state = {
  teamAName: "Team A",
  teamAScore: 0,
  teamAShots: 0,
  teamBName: "Team B",
  teamBScore: 0,
  teamBShots: 0,
  Period: 1,
  TimerSeconds: 1200,
  Running: false
};

let timerInterval;

async function fetchState() {
  try {
    const res = await fetch(SCRIPT_URL);
    const data = await res.json();
    // Update only if data exists
    Object.assign(state, data);
    updateUI();
  } catch(e) {
    console.error("Failed to fetch state:", e);
  }
}

function updateUI() {
  document.getElementById('teamAName').textContent = state.teamAName;
  document.getElementById('teamBName').textContent = state.teamBName;
  document.getElementById('teamAScore').textContent = state.teamAScore;
  document.getElementById('teamBScore').textContent = state.teamBScore;
  document.getElementById('teamAShots').textContent = `Shots: ${state.teamAShots}`;
  document.getElementById('teamBShots').textContent = `Shots: ${state.teamBShots}`;
  document.getElementById('timer').textContent = formatTime(state.TimerSeconds);
  document.getElementById('period').textContent = `Period ${state.Period}`;
}

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function startLocalTimer() {
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    if(state.Running && state.TimerSeconds > 0) {
      state.TimerSeconds--;
      document.getElementById('timer').textContent = formatTime(state.TimerSeconds);
    }
  }, 1000);
}

// Initial fetch and start local timer
fetchState();
startLocalTimer();

// Periodically poll Google Sheets for changes
setInterval(async () => {
  try {
    const res = await fetch(SCRIPT_URL);
    const data = await res.json();

    // Only update local state if there are differences
    if(data.Running !== state.Running || data.TimerSeconds !== state.TimerSeconds ||
       data.teamAName !== state.teamAName || data.teamBName !== state.teamBName ||
       data.teamAScore !== state.teamAScore || data.teamBScore !== state.teamBScore ||
       data.teamAShots !== state.teamAShots || data.teamBShots !== state.teamBShots ||
       data.Period !== state.Period) {
      Object.assign(state, data);
      updateUI();
    }
  } catch(e) {
    console.error("Failed to poll state:", e);
  }
}, 2000); // Poll every 2 seconds
</script>
</body>
</html>
