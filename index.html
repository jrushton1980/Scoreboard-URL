<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scoreboard Display</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: "Roboto", sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100vh;
  }

  #scoreboard {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 50px;
  }

  .team {
    text-align: center;
    width: 40%;
  }

  .team-logo {
    height: 80px;
    width: auto;
  }

  .team-name {
    font-size: 28px;
    font-weight: bold;
    margin-top: 10px;
  }

  .score {
    font-size: 80px;
    font-weight: bold;
  }

  .shots {
    font-size: 18px;
    margin-top: 5px;
    color: #ccc;
  }

  #center {
    text-align: center;
  }

  #clock {
    font-size: 64px;
    font-weight: bold;
  }

  #period {
    font-size: 28px;
    color: white;
  }
</style>
</head>
<body>
  <div id="scoreboard">
    <div id="teamA" class="team">
      <img id="teamALogo" class="team-logo" src="">
      <div id="teamAName" class="team-name"></div>
      <div id="teamAScore" class="score"></div>
      <div id="teamAShots" class="shots"></div>
    </div>

    <div id="center">
      <div id="clock">00:00 | Per 1</div>
    </div>

    <div id="teamB" class="team">
      <img id="teamBLogo" class="team-logo" src="">
      <div id="teamBName" class="team-name"></div>
      <div id="teamBScore" class="score"></div>
      <div id="teamBShots" class="shots"></div>
    </div>
  </div>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycbz1cCq3KGCdHG1km939b9IV4LRZkJeW5ldzG4RwH23o5KtvqoVSZrm_dqDsufE4a1jp/exec"; // <-- replace this with your actual web app URL

let lastState = {};
let lastTimerSeconds = null;
let localStartTime = null;

// format seconds as MM:SS
function formatTime(seconds) {
  const m = Math.floor(seconds / 60);
  const s = seconds % 60;
  return `${m.toString().padStart(2, "0")}:${s.toString().padStart(2, "0")}`;
}

// update the scoreboard display
function updateDisplay(state) {
  document.getElementById("teamAName").textContent = state.teamAName || "";
  document.getElementById("teamBName").textContent = state.teamBName || "";
  document.getElementById("teamAScore").textContent = state.teamAScore || "0";
  document.getElementById("teamBScore").textContent = state.teamBScore || "0";
  document.getElementById("teamAShots").textContent = "Shots: " + (state.teamAShots || "0");
  document.getElementById("teamBShots").textContent = "Shots: " + (state.teamBShots || "0");

  document.getElementById("teamALogo").src = state.teamALogo || "";
  document.getElementById("teamBLogo").src = state.teamBLogo || "";

  document.getElementById("teamAName").style.color = state.teamAColor || "#fff";
  document.getElementById("teamBName").style.color = state.teamBColor || "#fff";

  let seconds = parseInt(state.TimerSeconds) || 0;
  const running = String(state.Running).toUpperCase() === "TRUE";
  const period = state.Period || "1";

  if (running) {
    if (lastTimerSeconds !== seconds) {
      lastTimerSeconds = seconds;
      localStartTime = Date.now();
    } else if (localStartTime) {
      const elapsed = Math.floor((Date.now() - localStartTime) / 1000);
      seconds = Math.max(0, lastTimerSeconds - elapsed);
    }
  } else {
    lastTimerSeconds = seconds;
    localStartTime = null;
  }

  document.getElementById("clock").textContent = `${formatTime(seconds)} | Per ${period}`;
}

// fetch latest data from Google Sheets
async function fetchData() {
  try {
    const res = await fetch(DATA_URL);
    const state = await res.json();
    lastState = state;
    updateDisplay(state);
  } catch (err) {
    console.error("Error fetching data", err);
  }
}

// fetch every 2 seconds, update timer every 100ms for smooth countdown
setInterval(fetchData, 2000);
setInterval(() => {
  if (lastState) updateDisplay(lastState);
}, 100);
fetchData();
</script>
</body>
</html>
