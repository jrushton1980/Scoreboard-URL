<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
:root {
  --font-team-name: 'Arial', sans-serif;
  --font-team-name-size: 22px;

  --font-shots: 'Arial', sans-serif;
  --font-shots-size: 16px;

  --font-score: 'Arial', sans-serif;
  --font-score-size: 40px;

  --font-vs-size: 32px;

  --font-period: 'Arial', sans-serif;
  --font-period-size: 16px;
}

body { 
  margin:0; padding:0; 
  font-family: var(--font-team-name); 
  background: transparent; 
  display:flex; flex-direction: column; align-items:center; 
}

.scoreboard-wrapper { 
  position: relative; 
  display:flex; 
  justify-content:center; 
  align-items:center; 
  margin-top:40px; 
}

.team-card { 
  display:flex; 
  align-items:center; 
  justify-content:space-between; 
  width:260px; 
  height:55px; 
  background: rgba(0,0,0,0.7);
  border-radius:15px; 
  padding:10px 15px; 
  z-index:1; 
}

.team-info { 
  display:flex; 
  flex-direction:column; 
  justify-content:center; 
  flex-grow:1; 
  margin-left:10px; 
}

.team-logo { 
  width:60px; 
  height:60px; 
  border-radius:50%; 
  object-fit:cover; 
  border:2px solid #fff; 
}

.team-name { 
  font-family: var(--font-team-name); 
  font-size: var(--font-team-name-size); 
  font-weight:bold; 
  color:#fff; 
}

.shots { 
  font-family: var(--font-shots); 
  font-size: var(--font-shots-size); 
  color:#fff; 
}

.central-score { 
  position:absolute; 
  font-family: var(--font-score); 
  font-weight:bold; 
  font-size: var(--font-score-size); 
  background:rgba(0,0,0,0.7); 
  padding:15px 15px; 
  border-radius:20px; 
  box-shadow:0 0 20px rgba(0,0,0,0.5); 
  z-index:2; 
  display:flex; 
  flex-direction:column; 
  align-items:center; 
  justify-content:center; 
}

.score-row { 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  color:#fff; 
}

.vs { 
  font-size: var(--font-vs-size); 
  margin:0 10px; 
  color:#fff; 
}

.period-clock { 
  font-family: var(--font-period); 
  font-size: var(--font-period-size); 
  font-weight:normal; 
  margin-top:5px; 
  color:#fff; 
}

#teamAcard { margin-right:70px; }
#teamBcard { margin-left:70px; }
</style>
</head>
<body>
<div class="scoreboard-wrapper">
  <div class="team-card" id="teamAcard">
    <img class="team-logo" id="teamALogo">
    <div class="team-info">
      <div class="team-name" id="teamAName"></div>
      <div class="shots" id="teamAShots"></div>
    </div>
  </div>

  <div class="central-score">
    <div class="score-row">
      <span id="scoreA">0</span>
      <span class="vs">-</span>
      <span id="scoreB">0</span>
    </div>
    <div class="period-clock" id="periodClock">20:00 | Per 1</div>
  </div>

  <div class="team-card" id="teamBcard">
    <img class="team-logo" id="teamBLogo">
    <div class="team-info">
      <div class="team-name" id="teamBName"></div>
      <div class="shots" id="teamBShots"></div>
    </div>
  </div>
</div>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycby2aIU07zITspkHYBxTohwdWaFk5iU0C87dZb3f05BoLMSZnPVOPIWeDILQ03JTiI64/exec";

let timerSeconds = 20*60;
let running = false;
let period = 1;

// Track last known sheet state
let lastRunning = false;
let lastTimerSeconds = timerSeconds;

// Fetch data from Google Sheet
async function fetchData() {
  try {
    const res = await fetch(DATA_URL);
    const data = await res.json();

    // Update team info and scores
    document.getElementById("teamALogo").src = data.teamALogo || '';
    document.getElementById("teamAName").innerText = data.teamAName || '';
    document.getElementById("teamAShots").innerText = `Shots: ${data.teamAShots || 0}`;
    document.getElementById("teamAcard").style.backgroundColor = (data.teamAColor||"#000")+"33";

    document.getElementById("teamBLogo").src = data.teamBLogo || '';
    document.getElementById("teamBName").innerText = data.teamBName || '';
    document.getElementById("teamBShots").innerText = `Shots: ${data.teamBShots || 0}`;
    document.getElementById("teamBcard").style.backgroundColor = (data.teamBColor||"#000")+"33";

    document.getElementById("scoreA").innerText = data.teamAScore || 0;
    document.getElementById("scoreB").innerText = data.teamBScore || 0;

    period = data.Period || 1;

    // Only update local timer if sheet Running status changes
    const sheetRunning = data.Running === true || data.Running === "TRUE";
    const sheetTimer = parseInt(data.TimerSeconds) || 20*60;

    if(sheetRunning !== lastRunning || sheetTimer !== lastTimerSeconds){
      running = sheetRunning;
      timerSeconds = sheetTimer;
      lastRunning = sheetRunning;
      lastTimerSeconds = sheetTimer;
    }

    updateClockDisplay();
  } catch(err){
    console.error("Failed to fetch data:", err);
  }
}

function formatTime(sec){
  const m = Math.floor(sec/60);
  const s = sec % 60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function updateClockDisplay(){
  document.getElementById("periodClock").innerText = `${formatTime(timerSeconds)} | Per ${period}`;
}

// Smooth local timer
setInterval(()=>{
  if(running && timerSeconds>0){
    timerSeconds--;
    updateClockDisplay();
  }
},1000);

// Poll sheet every 2s for updates to Running/TimerSeconds
setInterval(fetchData,2000);

// Initial fetch
fetchData();
</script>
</body>
</html>
