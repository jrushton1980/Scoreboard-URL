<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<style>
:root {
  --font-team-name: 'Arial', sans-serif;
  --font-team-name-size: 22px;
  --font-shots: 'Arial', sans-serif;
  --font-shots-size: 16px;
  --font-score: 'Arial', sans-serif;
  --font-score-size: 36px;
  --font-vs-size: 26px;
  --font-period: 'Arial', sans-serif;
  --font-period-size: 16px;
}

body { 
  margin: 0; padding: 0;
  font-family: var(--font-team-name);
  background: transparent;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.scoreboard-wrapper {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 40px;
}

.team-card {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  width: 250px;
  height: 65px;
  background: rgba(0, 0, 0, 0.7);
  border-radius: 15px;
  padding: 8px 12px;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
}

.team-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  flex-grow: 1;
  margin-left: 12px;
}

.team-logo {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #fff;
  background-color: #222;
}

.team-name {
  font-size: var(--font-team-name-size);
  font-weight: bold;
  color: #fff;
  white-space: nowrap;
}

.shots {
  font-size: var(--font-shots-size);
  color: #fff;
}

.central-score {
  position: absolute;
  font-size: var(--font-score-size);
  font-weight: bold;
  background: rgba(0, 0, 0, 0.7);
  padding: 10px 15px;
  border-radius: 15px;
  box-shadow: 0 0 10px rgba(0,0,0,0.6);
  color: #fff;
  text-align: center;
  z-index: 2;
}

.score-row {
  display: flex;
  align-items: center;
  justify-content: center;
}

.vs {
  font-size: var(--font-vs-size);
  margin: 0 10px;
}

.period-clock {
  font-size: var(--font-period-size);
  margin-top: 3px;
}

#teamAcard { margin-right: 70px; }
#teamBcard { margin-left: 70px; }
</style>
</head>
<body>
  <div class="scoreboard-wrapper">
    <div class="team-card" id="teamAcard">
      <img class="team-logo" id="teamALogo" src="">
      <div class="team-info">
        <div class="team-name" id="teamAName">Team A</div>
        <div class="shots" id="teamAShots">Shots: 0</div>
      </div>
    </div>

    <div class="central-score">
      <div class="score-row">
        <span id="scoreA">0</span>
        <span class="vs">-</span>
        <span id="scoreB">0</span>
      </div>
      <div class="period-clock" id="periodClock">20:00 | Per 1</div>
    </div>

    <div class="team-card" id="teamBcard">
      <img class="team-logo" id="teamBLogo" src="">
      <div class="team-info">
        <div class="team-name" id="teamBName">Team B</div>
        <div class="shots" id="teamBShots">Shots: 0</div>
      </div>
    </div>
  </div>

<script>
const DATA_URL = "https://script.google.com/macros/s/AKfycbyD8EO--akOZZZNKGOEHk4mpc4Gk-1WXbiHyvVIOaSmxI5f20Wiwwh7XIyEc4TaOlxD/exec";

let timerSeconds = 20 * 60;
let running = false;
let period = 1;
let lastRunningState = null;

// Fetch scoreboard data
async function refresh() {
  try {
    const res = await fetch(DATA_URL + "?t=" + Date.now()); // prevent caching
    const data = await res.json();

    // Team info
    document.getElementById("teamALogo").src = data.teamALogo || "";
    document.getElementById("teamAName").innerText = data.teamAName || "Team A";
    document.getElementById("teamAShots").innerText = `Shots: ${data.teamAShots || 0}`;
    document.getElementById("teamAcard").style.backgroundColor = (data.teamAColor || "#000000") + "33";

    document.getElementById("teamBLogo").src = data.teamBLogo || "";
    document.getElementById("teamBName").innerText = data.teamBName || "Team B";
    document.getElementById("teamBShots").innerText = `Shots: ${data.teamBShots || 0}`;
    document.getElementById("teamBcard").style.backgroundColor = (data.teamBColor || "#000000") + "33";

    // Scores
    document.getElementById("scoreA").innerText = data.teamAScore || 0;
    document.getElementById("scoreB").innerText = data.teamBScore || 0;

    // Timer / period
    period = data.Period || 1;
    const newRunning = data.Running === true || data.Running === "TRUE";

    if (lastRunningState !== newRunning) {
      timerSeconds = parseInt(data.TimerSeconds) || 0;
      lastRunningState = newRunning;
    }

    running = newRunning;
  } catch (err) {
    console.error("Failed to fetch scoreboard data:", err);
  }
}

function updateClockDisplay() {
  const min = Math.floor(timerSeconds / 60);
  const sec = timerSeconds % 60;
  document.getElementById("periodClock").innerText = 
    `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')} | Per ${period}`;
}

// Local ticking
setInterval(() => {
  if (running && timerSeconds > 0) {
    timerSeconds--;
  } else if (timerSeconds <= 0) {
    timerSeconds = 0;
    running = false;
  }
  updateClockDisplay();
}, 1000);

// Refresh from Google Sheets
setInterval(refresh, 1500);
refresh();
updateClockDisplay();
</script>
</body>
</html>
